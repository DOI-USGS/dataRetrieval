<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dataRetrieval">
<title>How to Contribute • dataRetrieval</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="How to Contribute">
<meta property="og:description" content="dataRetrieval">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-53797708-7"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53797708-7');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://www.usgs.gov/" class="external-link"><img src="logo.png" id="logo" alt="Home" style="padding: 0px 50px 0px 0px;"></a>
    <a class="navbar-brand me-2" href="../index.html">dataRetrieval</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.7.12</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/dataRetrieval.html">Background</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Function Help</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-large-data-pull-examples">Large Data Pull Examples</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-large-data-pull-examples">
    <a class="dropdown-item" href="../articles/wqp_large_pull_script.html">Scripting Approach</a>
    <a class="dropdown-item" href="../articles/wqp_large_pull_targets.html">Pipeline Approach</a>
  </div>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/tutorial.html">Tutorial</a>
    <a class="dropdown-item" href="../articles/qwdata_changes.html">Changes to QW</a>
    <a class="dropdown-item" href="../articles/movingAverages.html">Moving Averages</a>
    <a class="dropdown-item" href="../articles/statsServiceMap.html">Stat Service</a>
    <a class="dropdown-item" href="../articles/nldi.html">NLDI Interface</a>
    <a class="dropdown-item" href="../articles/Contributing.html">How to Contribute</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/DOI-USGS/dataRetrieval">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>How to Contribute</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/DOI-USGS/dataRetrieval/blob/HEAD/vignettes/Contributing.Rmd" class="external-link"><code>vignettes/Contributing.Rmd</code></a></small>
      <div class="d-none name"><code>Contributing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="package-development">Package development<a class="anchor" aria-label="anchor" href="#package-development"></a>
</h2>
<p>This article will walk through adding a function to the package. It
will use a git-branching workflow, but it is not a full git tutorial.
This is also not a complete guide to R package development (a
comprehensive guide is <a href="https://r-pkgs.org/" class="external-link">R Packages</a>),
instead this is meant as more of a checklist for the general steps.
Several references are included at the bottom for more information on <a href="https://r-pkgs.org/" class="external-link">R-package</a> development and <a href="https://happygitwithr.com/" class="external-link">git</a> workflows.</p>
</div>
<div class="section level2">
<h2 id="initial-setup">Initial Setup<a class="anchor" aria-label="anchor" href="#initial-setup"></a>
</h2>
<p>This section will describe the steps necessary to get started. These
steps will only need to be done once.</p>
<div class="section level3">
<h3 id="required-installations">Required installations<a class="anchor" aria-label="anchor" href="#required-installations"></a>
</h3>
<p>There are several programs that are needed before any work can begin.
With admin access to your computer, you can install all of these,
otherwise create a ticket with your IT group with the following
requests. The links provided assume a Windows computer. Adjustments
might be needed for Mac or Linux OS:</p>
<ul>
<li><p><a href="https://cran.r-project.org/bin/windows/base/" class="external-link">R</a></p></li>
<li><p><a href="https://www.rstudio.com/products/rstudio/download/" class="external-link">RStudio</a></p></li>
<li><p><a href="https://cran.r-project.org/bin/windows/Rtools/" class="external-link">Rtools</a> -
needed for Windows users.</p></li>
<li><p><a href="https://git-scm.com/downloads" class="external-link">Git</a></p></li>
<li><p><a href="https://miktex.org/" class="external-link">MikTex</a> - optional for Windows
users to use LaTeX.</p></li>
</ul>
<p>Once those have been installed, the following R packages will be
needed for R-package development work:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"devtools"</span>, <span class="st">"rmarkdown"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="github-versus-gitlab">GitHub versus GitLab<a class="anchor" aria-label="anchor" href="#github-versus-gitlab"></a>
</h2>
<p>dataRetrieval is a publicly available package. The public is urged to
report issues and ask questions on our GitHub page: <a href="https://github.com/DOI-USGS/dataRetrieval/issues" class="external-link">GitHub
Issues</a></p>
<p>The public is welcome to fork the <a href="https://github.com/DOI-USGS/dataRetrieval" class="external-link">GitHub repository</a>
and can submit pull requests. Since dataRetrieval is used by so many
people, any proposed changes will be thoroughly reviewed before being
considered.</p>
<p>dataRetrieval development done by USGS employees is done on <a href="https://code.usgs.gov/water/dataRetrieval" class="external-link">code.usgs.gov/water/dataRetrieval</a>.
This is the USGS GitLab system. Throughout this document, it will be
referred to both as code.usgs.gov and GitLab. Once updates and bug fixes
are tested on GitLab, they will be pushed up to the GitHub
repository.</p>
<div class="section level3">
<h3 id="code-usgs-gov-gitlab-setup">code.usgs.gov (GitLab) setup<a class="anchor" aria-label="anchor" href="#code-usgs-gov-gitlab-setup"></a>
</h3>
<p>USGS or DOI employees can use code.usgs.gov for dataRetrieval
development. This section shows the steps to setup development work
through the code.usgs.gov system.</p>
<p>code.usgs.gov is the USGS enterprise GitLab home. Some people will
either refer it as either code.usgs.gov or simply “GitLab”. These
instructions will generally refer to code.usgs.gov as GitLab unless it’s
specific to our USGS version of GitLab (for example, how to log in). If
you have questions on how to use code.usgs.gov, general advice about
GitLab will often suffice (so Googling for answers is a great first
step!)</p>
<p>The first step to collaborating via code.usgs.gov is to log in. For
USGS/DOI employees, that means using:</p>
<p><img src="login.png" width="60%"></p>
<div class="section level4">
<h4 id="personal-access-token">Personal Access Token<a class="anchor" aria-label="anchor" href="#personal-access-token"></a>
</h4>
<p>This step only needs to be done once per computer setup. So if you’ve
done it before you can skip this step.</p>
<p>You’ll need to set up a Personal Access Token. Go to <a href="https://code.usgs.gov/-/profile/personal_access_tokens" class="external-link">https://code.usgs.gov/-/profile/personal_access_tokens</a>
and create a new token selecting the api scope:</p>
<p><img src="pat.png" width="60%"></p>
<p>After clicking the green “Create personal access token”, you will see
a screen like this: <img src="save_pat.png" width="60%"></p>
<p>Save your token in a safe place (KeyPass for instance) so you don’t
need to constantly regenerate tokens. You will need this token for
authenticating when doing a git pull (in a few steps….).</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="local-project-setup">Local project setup<a class="anchor" aria-label="anchor" href="#local-project-setup"></a>
</h2>
<p>The easiest way to set up work on this package is to create a new
Project within RStudio. These are the steps needed to get the files from
GitLab (for USGS/DOI employees) or GitHub (external collaborators) to
your computer.</p>
<ol style="list-style-type: decimal">
<li>Create a new project -&gt; Version Control -&gt; Git</li>
</ol>
<p><img src="new_project.png" width="50%"></p>
<ol start="2" style="list-style-type: decimal">
<li>Navigate to the landing page for the repository to find the
Repository URL.</li>
</ol>
<p>From code.usgs.gov, use the “Clone” button and copy the HTTPS
URL:</p>
<p><img src="https_clone.png" width="50%"></p>
<p>From GitHub, use the “Code” button and copy the SSH url:</p>
<p><img src="github_code.png" width="50%"></p>
<ol start="3" style="list-style-type: decimal">
<li>Paste the HTTPS git address in Repository URL:</li>
</ol>
<p><img src="git_repository.png" width="50%"></p>
<ol start="4" style="list-style-type: decimal">
<li>Logging in</li>
</ol>
<p>You may need to log in (if you’ve logged in before, there will not be
a log in prompt and you can skip this step).</p>
<p>For code.usgs.gov, use your full email for your user name, and the
personal access token for your password. NOT your AD password!</p>
<p><img src="git_login.png" width="60%"></p>
<p>If you attempt to use HTTPS and are not even prompted for a password,
but you receive a failed authentication error message, then you probably
at one point in the past provided an incorrect username/password and
Windows (or MacOS) chose to store that password in their built-in
credential manager. On Windows, this is called Credential Manager. On
Mac, this is called Keychain. Clear that credential and try again.</p>
<p>For GitHub, see <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account" class="external-link">Adding
a New SSH Key</a>.</p>
</div>
<div class="section level2">
<h2 id="setup-local-build">Setup Local Build<a class="anchor" aria-label="anchor" href="#setup-local-build"></a>
</h2>
<div class="section level3">
<h3 id="initial-installation">Initial Installation<a class="anchor" aria-label="anchor" href="#initial-installation"></a>
</h3>
<p>Click “Install and Restart” from Build tab in the upper right of your
RStudio window. If there are packages that this package depends on and
they are not installed on your computer, you will get a warning. Install
those packages manually and try the “Install and Restart” again. If
successful, you will see something like:</p>
<p><img src="install.png" width="50%"></p>
<p>The most common problem at this stage will be that you might not have
all the packages that are listed in either the Depends or Imports of the
DESCRIPTION file. If you see a message like this:</p>
<p><img src="install_error.png" width="50%"></p>
<p>Read which package is missing from your computer and install, or you
can use the <code>remotes</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_deps.html" class="external-link">install_deps</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="set-up-roxygen-options">Set up roxygen options<a class="anchor" aria-label="anchor" href="#set-up-roxygen-options"></a>
</h3>
<p>Turn on the option to use Roxygen to build help pages. Click on the
More button in the “Build” tab, then choose “Configure Build Tools”.</p>
<p><img src="roxygen.png" width="60%"></p>
<p>Click the radio button to “Generate documentation with Roxygen”. Then
click the Configure button and check all the options:</p>
<p><img src="doc_all.png" width="50%"></p>
<p>If you do not have some LaTeX software installed (on Windows that
would be MikTex for instance), you will want to include
<code>--no-manual</code> in your check options.</p>
<p><img src="no_manual.png" width="50%"></p>
<p>Click “OK” to exit out of all of the configuration options. You are
now set to start working on the package!</p>
</div>
</div>
<div class="section level2">
<h2 id="r-package-development">R-package development<a class="anchor" aria-label="anchor" href="#r-package-development"></a>
</h2>
<p>We’re now setup to start contributing to the R-package! This next
section will walk through adding a new function to the package.</p>
<div class="section level3">
<h3 id="project-management">Project management<a class="anchor" aria-label="anchor" href="#project-management"></a>
</h3>
<p>Planned dataRetrieval work will be done on GitLab. Public inquiries,
bug reports, and enhancement requests are done on GitHub. Both
environments have similar features.</p>
<p>Each distinct set of work tasks should be described in a single
issue. The issues should have enough detail to describe the required
work and an example of how to test if the task is complete. Discussions
of the issues can include screenshots, formatted code snippets, and
general markdown formatting options. Each task should be assigned to a
developer. Appropriate labels should be assigned to the task. Issue
templates are provided. Developers are encouraged to use git commands to
reference issues.</p>
<p>A few developers have the authority to merge updates into the main
branch of dataRetrieval. Each merge/pull request must be reviewed by an
authorized approver. Approvers must check that the updates are
functional and efficient. Since dataRetrieval is on CRAN, examples and
tests that hit web services should be flagged to not run on CRAN.
Approvers should try to consider unique use-cases that may not be
addressed in the original Issue. Additional topics that approvers should
be checking for increased test coverage, minimizing new package
dependencies, consistent coding style, and consistent user experience.
Ideally authorized approvers get another approver to check their merge
requests, but it is not required.</p>
</div>
<div class="section level3">
<h3 id="set-up-a-new-git-branch">Set up a new git branch<a class="anchor" aria-label="anchor" href="#set-up-a-new-git-branch"></a>
</h3>
<p>Before starting anything new, try to always remember to pull any
changes that have happened on the repo. In the “Git” tab, click the down
arrow which triggers a “git pull”:</p>
<p><img src="pull.png" width="50%"></p>
<p>Create a new branch. This will let you work on your idea without
risking adding in-development work into the “main” branch of the
repository. As a good rule-of-thumb, consider creating a new branch for
each “Issue”.</p>
<p><img src="new_branch.png" width="50%"></p>
</div>
<div class="section level3">
<h3 id="building-a-new-function">Building a new function<a class="anchor" aria-label="anchor" href="#building-a-new-function"></a>
</h3>
<p>You have all the details for a new function, great! Here are some
steps to get it fully incorporated into the package so others can use
it. See <a href="https://r-pkgs.org/" class="external-link">R Packages</a> for complete
details. Follow the style and guidelines agreed upon by the package
development team.</p>
<p>Here is an example of some of a new function which follows our
package guidelines. Save this as an R file in the “R” folder of the
package.</p>
<pre><code><span><span class="co">#' My fancy new function</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' This is my fancy new function. It's really great.</span></span>
<span><span class="co">#' </span></span>
<span><span class="co">#' @param excited_flag logical. This sets our output</span></span>
<span><span class="co">#' to excited or not</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#' @examples </span></span>
<span><span class="co">#' my_fancy_function(excited_flag = TRUE)</span></span>
<span><span class="co">#' my_fancy_function(excited_flag = FALSE)</span></span>
<span><span class="va">my_fancy_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">excited_flag</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/logical.html" class="external-link">is.logical</a></span><span class="op">(</span><span class="va">excited_flag</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Input is not a length one logical vector"</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="kw">if</span><span class="op">(</span><span class="va">excited_flag</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">say</span> <span class="op">&lt;-</span> <span class="st">"HI!"</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">say</span> <span class="op">&lt;-</span> <span class="st">"hi"</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">say</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="local-package-check">Local Package Check<a class="anchor" aria-label="anchor" href="#local-package-check"></a>
</h3>
<p>Check the package to make sure the function works properly, and
doesn’t add any new Errors, Warnings, Notes.</p>
<p><img src="check.png" width="50%"></p>
<p>Note sometimes this can take a long time. The package will be checked
automatically on code.usgs.gov with the CI pipeline, but it is still a
good idea to run the check locally especially when setting up a new
function initially.</p>
</div>
<div class="section level3">
<h3 id="creating-tests">Creating tests<a class="anchor" aria-label="anchor" href="#creating-tests"></a>
</h3>
<p>It’s also important to create tests to check that your functions do
exactly what you expect them to do. Use the <a href="https://testthat.r-lib.org/" class="external-link">testthat</a> package to create these
tests. Navigate to the tests/testthat folder and create some new tests
for your new function. As much as possible, the tests should check every
part of your function.</p>
<pre><code><span><span class="fu">context</span><span class="op">(</span><span class="st">"Test my fancy function"</span><span class="op">)</span></span>
<span><span class="fu">test_that</span><span class="op">(</span><span class="st">"My fancy function"</span>, <span class="op">{</span></span>
<span></span>
<span>  <span class="va">excited</span> <span class="op">&lt;-</span> <span class="fu">my_fancy_function</span><span class="op">(</span>excited_flag <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="va">not_excited</span> <span class="op">&lt;-</span> <span class="fu">my_fancy_function</span><span class="op">(</span>excited_flag <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">expect_type</span><span class="op">(</span><span class="va">excited</span>, type <span class="op">=</span> <span class="st">"character"</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">excited</span>, <span class="st">"HI!"</span><span class="op">)</span></span>
<span>  <span class="fu">expect_equal</span><span class="op">(</span><span class="va">not_excited</span>, <span class="st">"hi"</span><span class="op">)</span></span>
<span>  <span class="fu">expect_error</span><span class="op">(</span><span class="fu">my_fancy_function</span><span class="op">(</span>excited_flag <span class="op">=</span> <span class="st">"what?"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
<p>In the “Build” tab, under “More”, test the full package</p>
<p><img src="test.png" width="50%"></p>
</div>
<div class="section level3">
<h3 id="adding-the-function-to-vignettes-readme-report-template-">Adding the function to vignettes, README, report template.<a class="anchor" aria-label="anchor" href="#adding-the-function-to-vignettes-readme-report-template-"></a>
</h3>
<p>If the function should be advertised in the general workflow,
consider adding it to the README. This is the first place users will
read when they come to the code repository.</p>
<p>The function could be added to a section of a vignette, or an
entirely new vignette could be written.</p>
<p>In some packages, there is a report template that is in the
“inst/templates” folder. Consider if function would make sense in a
generalized report.</p>
</div>
<div class="section level3">
<h3 id="push-up-to-code-repository">Push up to code repository<a class="anchor" aria-label="anchor" href="#push-up-to-code-repository"></a>
</h3>
<p>This can be done in stages. If you’ve done everything correctly, you
should be ready to commit at least the R script, the generated Rd
documentation file, the testthat changes, and the updates to the
NAMESPACE.</p>
<ol style="list-style-type: decimal">
<li><p>In the Git tab, click the down arrow to “Pull”. If you haven’t
made any changes on this branch yet, you should get a message “Already
up to date”.</p></li>
<li><p>In the same Git tab, click the radio buttons next to the files
you are either adding or modifying. This should include the R script for
the function, the test file(s), the Rd documentation, and the updated
NAMESPACE. It could also include changes to the README, vignettes,
inst/template/report.Rmd, etc. Then click the “Commit” button:</p></li>
</ol>
<p><img src="commit1.png" width="75%"></p>
<ol start="3" style="list-style-type: decimal">
<li>Write a message to help you remember what this commit was all about.
Glance at the “Diffs” shown below. When everything looks good, click
“Commit”.</li>
</ol>
<p><img src="commit2.png" width="75%"></p>
<ol start="4" style="list-style-type: decimal">
<li>Click the up arrow to “Push” the changes up to the feature branch in
GitLab (code.usgs.gov).</li>
</ol>
</div>
<div class="section level3">
<h3 id="gitlab-ci-pipeline">Gitlab CI Pipeline<a class="anchor" aria-label="anchor" href="#gitlab-ci-pipeline"></a>
</h3>
<p>The repository should have a file already set up called
.gitlab-ci.yml. This file organizes automatic checks on the package via
a “pipeline”. Usually there is a setup phase that installs all the
required package, then a check phase to check the package. I like to add
separate testing and test coverage checks. Before the merge request is
merged, the pipeline should come back with no errors:</p>
<p><img src="pipeline.png" width="75%"></p>
<p>This helps assure that the changes are not causing any failures on an
independent platform.</p>
</div>
<div class="section level3">
<h3 id="merge-request">Merge request<a class="anchor" aria-label="anchor" href="#merge-request"></a>
</h3>
<p>So far, you have pushed a specific branch up to code.usgs.gov. It’s
not set to go directly to the “main” branch. If you open the repository,
you may see a message like this:</p>
<p><img src="create_merge.png" width="75%"></p>
<p>Click on that “Create merge request” to initiate a “merge
request”.</p>
<p><img src="merge_request.png" width="75%"></p>
<p>Fill in some more information on what is being included in this merge
request. You could assign someone to do a peer review of your code. This
is a great place for review. It is a good idea to discuss with your
collaborators if you want guidelines set up to decide who has the
responsibility to perform the merge (that is…click the Merge
button).</p>
<div class="section level4">
<h4 id="merge-reports">Merge Reports<a class="anchor" aria-label="anchor" href="#merge-reports"></a>
</h4>
<p>There are a few things to check when the pipeline has finished. The
first main goal is that the package passes all the checks. The next
thing to check is the test coverage. When you write tests in the
“testthat” folder, you are checking that the code is doing what it’s
suppose to be doing. We can also check how well your code is covered by
tests. This is called “test coverage”. There are programs that can
analyze each line of your code and determine which lines are being
tested, and which lines are not. A high percentage of test coverage is
one metric of good testing. However, it is also important to write good
and meaningful tests. If you only test that a function didn’t fail, you
still don’t know if the function produced meaningful output.</p>
<p>The test coverage should be as good if not better than the coverage
currently in the canonical “main” branch. In the following screenshot,
the test coverage on the “main” branch is 92.11%. The pull request is
set to increase that coverage by 0.11% to 92.22%. If you notice the test
coverage decreasing, you will want to look at your test suite and see
where you can add tests to make sure your package is working properly.
This screenshot also shows where to get a full report on the tests in
your package.</p>
<p><img src="more_tests.png" width="75%"></p>
<p>Another report that GitLab can produced is found in the “Changes” tab
in the merge request. There are green and red vertical lines on the file
diffs. These vertical lines indicate the code is covered by a test
(green line), or that there is no test (thicker red line).</p>
<p><img src="test_included.png" width="75%"></p>
<p>This can be useful for finding parts of your code that are not
covered by tests.</p>
<p>If the Pipeline has passed and the code review was satisfactory,
clicking the Merge button will move all your changes into the “main”
branch.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="clean-up-local-enviornment">Clean up local enviornment<a class="anchor" aria-label="anchor" href="#clean-up-local-enviornment"></a>
</h2>
<p>Congratulations, you contributed to the package! The next steps
should always be done after the merge request is completed so you don’t
continue to work on the specific feature branch.</p>
<div class="section level3">
<h3 id="switch-back-to-main-branch">Switch back to “main” branch<a class="anchor" aria-label="anchor" href="#switch-back-to-main-branch"></a>
</h3>
<p>In the upper right corner of the Git window in RStudio, you can click
a dropdown to get back to the “main” branch.</p>
<p><img src="back_to_main.png" width="50%"></p>
</div>
<div class="section level3">
<h3 id="delete-local-feature-branch">Delete local feature branch<a class="anchor" aria-label="anchor" href="#delete-local-feature-branch"></a>
</h3>
<p>The way code.usgs.gov is set up, the branch should be automatically
deleted <em>ON</em> code.usgs.gov. You will still want to delete the
feature branch locally. Go to the Terminal in the lower left corner in
RStudio, and type <code>git branch -d my_fancy_function</code> (or
whatever you named your branch).</p>
<p><img src="delete_branch.png" width="50%"></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li><p><a href="https://r-pkgs.org/" class="external-link">R Packages</a></p></li>
<li><p><a href="https://happygitwithr.com/" class="external-link">Happy with Git</a></p></li>
<li><p><a href="https://testthat.r-lib.org/" class="external-link">testthat</a></p></li>
<li><p><a href="https://r4ds.had.co.nz/r-markdown.html" class="external-link">R
markdown</a></p></li>
<li><p><a href="https://www.usgs.gov/products/software/software-management" class="external-link">USGS
Software Policy</a></p></li>
</ul>
</div>
<div class="section level2">
<h2 id="disclaimer">Disclaimer<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h2>
<p>This software is preliminary or provisional and is subject to
revision. It is being provided to meet the need for timely best science.
The software has not received final approval by the U.S. Geological
Survey (USGS). No warranty, expressed or implied, is made by the USGS or
the U.S. Government as to the functionality of the software and related
material nor shall the fact of release constitute any such warranty. The
software is provided on the condition that neither the USGS nor the U.S.
Government shall be held liable for any damages resulting from the
authorized or unauthorized use of the software.</p>
<p>Any use of trade, firm, or product names is for descriptive purposes
only and does not imply endorsement by the U.S. Government.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer></footer>
</div> <!-- / div for your main content-->

<!-- BEGIN USGS Footer Template -->

<footer class="footer"><div class="tmp-container">
		<!-- .footer-wrap -->
			<!-- .footer-doi -->
			<div class="footer-doi">
				<!-- footer nav links -->
				<ul class="menu nav">
<li class="first leaf menu-links menu-level-1"><a href="https://www.doi.gov/privacy" class="external-link">DOI Privacy Policy</a></li>
					<li class="leaf menu-links menu-level-1"><a href="https://www.usgs.gov/policies-and-notices" class="external-link">Legal</a></li>
					<li class="leaf menu-links menu-level-1"><a href="https://www.usgs.gov/accessibility-and-us-geological-survey" class="external-link">Accessibility</a></li>
					<li class="leaf menu-links menu-level-1"><a href="https://www.usgs.gov/sitemap" class="external-link">Site Map</a></li>
					<li class="last leaf menu-links menu-level-1"><a href="https://answers.usgs.gov/" class="external-link">Contact USGS</a></li>
				</ul>
<!--/ footer nav links -->
</div>
			<!-- /.footer-doi -->

			<hr>
<!-- .footer-utl-links --><div class="footer-doi">
			<ul class="menu nav">
<li class="first leaf menu-links menu-level-1"><a href="https://www.doi.gov/" class="external-link">U.S. Department of the Interior</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.doioig.gov/" class="external-link">DOI Inspector General</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.whitehouse.gov/" class="external-link">White House</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.whitehouse.gov/omb/management/egov/" class="external-link">E-gov</a></li>
				<li class="leaf menu-links menu-level-1"><a href="https://www.doi.gov/pmb/eeo/no-fear-act" class="external-link">No Fear Act</a></li>
				<li class="last leaf menu-links menu-level-1"><a href="https://www.usgs.gov/about/organization/science-support/foia" class="external-link">FOIA</a></li>
			</ul>
</div>			
		<!-- /.footer-utl-links -->
		<!-- .footer-social-links -->
		<div class="footer-social-links">
			<ul class="social">
<li class="follow">Follow</li>
				<li class="twitter">
					<a href="https://twitter.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-twitter-square"><span class="only">Twitter</span></i>
					</a>
				</li>
				<li class="facebook">
					<a href="https://facebook.com/usgeologicalsurvey" target="_blank" class="external-link">
						<i class="fa fa-facebook-square"><span class="only">Facebook</span></i>
					</a>
				</li>
				<li class="github">
					<a href="https://github.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-github"><span class="only">GitHub</span></i>
					</a>
				</li>
				<li class="flickr">
					<a href="https://flickr.com/usgeologicalsurvey" target="_blank" class="external-link">
						<i class="fa fa-flickr"><span class="only">Flickr</span></i>
					</a>
				</li>
				<li class="youtube">
					<a href="http://youtube.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-youtube-play"><span class="only">YouTube</span></i>
					</a>
				</li>
				<li class="instagram">
					<a href="https://instagram.com/usgs" target="_blank" class="external-link">
						<i class="fa fa-instagram"><span class="only">Instagram</span></i>
					</a>
				</li>
			</ul>
</div>
		<!-- /.footer-social-links -->
	</div>
		<!-- /.footer-wrap -->	
</footer><!-- END USGS Footer Template- --><!-- Google Tag Manager (noscript) --><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TKQR8KP" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
  
  </body>
<!-- closing div for body -->
</html>
