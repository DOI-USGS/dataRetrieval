<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculating Moving Averages and Historical Flow Quantiles â€¢ dataRetrieval</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Calculating Moving Averages and Historical Flow Quantiles">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-53797708-7"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-53797708-7');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dataRetrieval</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.7.4.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/dataRetrieval.html">Background</a>
</li>
<li>
  <a href="../reference/index.html">Function Help</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/movingAverages.html">Moving Averages</a>
    </li>
    <li>
      <a href="../articles/statsServiceMap.html">Stat Service</a>
    </li>
    <li>
      <a href="../articles/earthquake.html">Earthquake Exploration</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/USGS-R/dataRetrieval">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Calculating Moving Averages and Historical Flow Quantiles</h1>
                        <h4 class="author">Laura DeCicco</h4>
            
            <h4 class="date">2016-10-25</h4>
      
      
      <div class="hidden name"><code>movingAverages.Rmd</code></div>

    </div>

    
    
<p>This post will show simple way to calculate moving averages, calculate historical-flow quantiles, and plot that information. The goal is to reproduce the graph at this link: <a href="http://pa.water.usgs.gov/drought/indicators/sw/images/f30_01538000.html">PA Graph</a>. The motivation for this post was inspired by a USGS colleague that that is considering creating these type of plots in R. We thought this plot provided an especially fun challenge - maybe you will, too!</p>
<p>First we get the data using the <a href="https://CRAN.R-project.org/package=dataRetrieval">dataRetrieval</a> package. The siteNumber and parameterCd could be adjusted for other sites or measured parameters. In this example, we are getting discharge (parameter code 00060) at a site in PA.</p>
<p>It may be important to note that this script is a bit lazy in handling leap days.</p>
<div id="get-data-using-dataretrieval" class="section level2">
<h2 class="hasAnchor">
<a href="#get-data-using-dataretrieval" class="anchor"></a>Get data using dataRetrieval</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dataRetrieval)</a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="co">#Retrieve daily Q</span></a>
<a class="sourceLine" id="cb1-4" title="4">siteNumber&lt;-<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"01538000"</span>)</a>
<a class="sourceLine" id="cb1-5" title="5">parameterCd &lt;-<span class="st"> "00060"</span> <span class="co">#Discharge</span></a>
<a class="sourceLine" id="cb1-6" title="6">dailyQ &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readNWISdv.html">readNWISdv</a></span>(siteNumber, parameterCd) </a>
<a class="sourceLine" id="cb1-7" title="7">dailyQ &lt;-<span class="st"> </span><span class="kw"><a href="../reference/renameNWISColumns.html">renameNWISColumns</a></span>(dailyQ)</a>
<a class="sourceLine" id="cb1-8" title="8">stationInfo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/readNWISsite.html">readNWISsite</a></span>(siteNumber)</a></code></pre></div>
</div>
<div id="calculate-moving-average" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-moving-average" class="anchor"></a>Calculate moving average</h2>
<p>Next, we calculate a 30-day moving average on all of the flow data:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(dplyr)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="co">#Check for missing days, if so, add NA rows:</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="cf">if</span>(<span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/diff.html">diff</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/range.html">range</a></span>(dailyQ<span class="op">$</span>Date))) <span class="op">!=</span><span class="st"> </span>(<span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(dailyQ)<span class="op">+</span><span class="dv">1</span>)){</a>
<a class="sourceLine" id="cb2-5" title="5">  fullDates &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from=</span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(dailyQ<span class="op">$</span>Date),</a>
<a class="sourceLine" id="cb2-6" title="6">                   <span class="dt">to =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(dailyQ<span class="op">$</span>Date), <span class="dt">by=</span><span class="st">"1 day"</span>)</a>
<a class="sourceLine" id="cb2-7" title="7">  fullDates &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">Date =</span> fullDates, </a>
<a class="sourceLine" id="cb2-8" title="8">                          <span class="dt">agency_cd =</span> dailyQ<span class="op">$</span>agency_cd[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb2-9" title="9">                          <span class="dt">site_no =</span> dailyQ<span class="op">$</span>site_no[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb2-10" title="10">                          <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-11" title="11">  dailyQ &lt;-<span class="st"> </span><span class="kw">full_join</span>(dailyQ, fullDates,</a>
<a class="sourceLine" id="cb2-12" title="12">                      <span class="dt">by=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Date"</span>,<span class="st">"agency_cd"</span>,<span class="st">"site_no"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="st">    </span><span class="kw">arrange</span>(Date)</a>
<a class="sourceLine" id="cb2-14" title="14">}</a>
<a class="sourceLine" id="cb2-15" title="15"></a>
<a class="sourceLine" id="cb2-16" title="16">ma &lt;-<span class="st"> </span><span class="cf">function</span>(x,<span class="dt">n=</span><span class="dv">30</span>){stats<span class="op">::</span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(x,<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="dv">1</span><span class="op">/</span>n,n), <span class="dt">sides=</span><span class="dv">1</span>)}</a>
<a class="sourceLine" id="cb2-17" title="17"></a>
<a class="sourceLine" id="cb2-18" title="18">dailyQ &lt;-<span class="st"> </span>dailyQ <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">rollMean =</span> <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw">ma</span>(Flow)),</a>
<a class="sourceLine" id="cb2-20" title="20">         <span class="dt">day.of.year =</span> <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span>(Date, </a>
<a class="sourceLine" id="cb2-21" title="21">                                           <span class="dt">format =</span> <span class="st">"%j"</span>)))</a></code></pre></div>
</div>
<div id="calculate-historical-percentiles" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-historical-percentiles" class="anchor"></a>Calculate historical percentiles</h2>
<p>We can use the <code>quantile</code> function to calculate historical percentile flows. Then use the <code>loess</code> function for smoothing. The argument <code>smooth.span</code> defines how much smoothing should be applied. To get a smooth transistion at the start of the graph, we can add include an earlier year which is not plotted at the end.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">summaryQ &lt;-<span class="st"> </span>dailyQ <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-2" title="2"><span class="st">  </span><span class="kw">group_by</span>(day.of.year) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">p75 =</span> <span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(rollMean, <span class="dt">probs =</span> <span class="fl">.75</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb3-4" title="4">            <span class="dt">p25 =</span> <span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(rollMean, <span class="dt">probs =</span> <span class="fl">.25</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb3-5" title="5">            <span class="dt">p10 =</span> <span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(rollMean, <span class="dt">probs =</span> <span class="fl">0.1</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb3-6" title="6">            <span class="dt">p05 =</span> <span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(rollMean, <span class="dt">probs =</span> <span class="fl">0.05</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),</a>
<a class="sourceLine" id="cb3-7" title="7">            <span class="dt">p00 =</span> <span class="kw"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(rollMean, <span class="dt">probs =</span> <span class="dv">0</span>, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) </a>
<a class="sourceLine" id="cb3-8" title="8"></a>
<a class="sourceLine" id="cb3-9" title="9">current.year &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>(), <span class="dt">format =</span> <span class="st">"%Y"</span>))</a>
<a class="sourceLine" id="cb3-10" title="10"></a>
<a class="sourceLine" id="cb3-11" title="11">summary<span class="fl">.0</span> &lt;-<span class="st"> </span>summaryQ <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(day.of.year <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb3-13" title="13">                        <span class="dt">origin =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(current.year<span class="dv">-2</span>,<span class="st">"-01-01"</span>)),</a>
<a class="sourceLine" id="cb3-14" title="14">         <span class="dt">day.of.year =</span> day.of.year <span class="op">-</span><span class="st"> </span><span class="dv">365</span>)</a>
<a class="sourceLine" id="cb3-15" title="15">summary<span class="fl">.1</span> &lt;-<span class="st"> </span>summaryQ <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-16" title="16"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(day.of.year <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb3-17" title="17">                        <span class="dt">origin =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(current.year<span class="dv">-1</span>,<span class="st">"-01-01"</span>)))</a>
<a class="sourceLine" id="cb3-18" title="18">summary<span class="fl">.2</span> &lt;-<span class="st"> </span>summaryQ <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-19" title="19"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Date =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(day.of.year <span class="op">-</span><span class="st"> </span><span class="dv">1</span>, </a>
<a class="sourceLine" id="cb3-20" title="20">                        <span class="dt">origin =</span> <span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(current.year,<span class="st">"-01-01"</span>)),</a>
<a class="sourceLine" id="cb3-21" title="21">         <span class="dt">day.of.year =</span> day.of.year <span class="op">+</span><span class="st"> </span><span class="dv">365</span>)</a>
<a class="sourceLine" id="cb3-22" title="22"></a>
<a class="sourceLine" id="cb3-23" title="23">summaryQ &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(summary<span class="fl">.0</span>, summary<span class="fl">.1</span>, summary<span class="fl">.2</span>) </a>
<a class="sourceLine" id="cb3-24" title="24"></a>
<a class="sourceLine" id="cb3-25" title="25">smooth.span &lt;-<span class="st"> </span><span class="fl">0.3</span></a>
<a class="sourceLine" id="cb3-26" title="26"></a>
<a class="sourceLine" id="cb3-27" title="27">summaryQ<span class="op">$</span>sm<span class="fl">.75</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span>(p75<span class="op">~</span>day.of.year, <span class="dt">data =</span> summaryQ, <span class="dt">span =</span> smooth.span))</a>
<a class="sourceLine" id="cb3-28" title="28">summaryQ<span class="op">$</span>sm<span class="fl">.25</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span>(p25<span class="op">~</span>day.of.year, <span class="dt">data =</span> summaryQ, <span class="dt">span =</span> smooth.span))</a>
<a class="sourceLine" id="cb3-29" title="29">summaryQ<span class="op">$</span>sm<span class="fl">.10</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span>(p10<span class="op">~</span>day.of.year, <span class="dt">data =</span> summaryQ, <span class="dt">span =</span> smooth.span))</a>
<a class="sourceLine" id="cb3-30" title="30">summaryQ<span class="op">$</span>sm<span class="fl">.05</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span>(p05<span class="op">~</span>day.of.year, <span class="dt">data =</span> summaryQ, <span class="dt">span =</span> smooth.span))</a>
<a class="sourceLine" id="cb3-31" title="31">summaryQ<span class="op">$</span>sm<span class="fl">.00</span> &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/loess.html">loess</a></span>(p00<span class="op">~</span>day.of.year, <span class="dt">data =</span> summaryQ, <span class="dt">span =</span> smooth.span))</a>
<a class="sourceLine" id="cb3-32" title="32"></a>
<a class="sourceLine" id="cb3-33" title="33">summaryQ &lt;-<span class="st"> </span><span class="kw">select</span>(summaryQ, Date, day.of.year,</a>
<a class="sourceLine" id="cb3-34" title="34">                   sm<span class="fl">.75</span>, sm<span class="fl">.25</span>, sm<span class="fl">.10</span>, sm<span class="fl">.05</span>, sm<span class="fl">.00</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-35" title="35"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(Date <span class="op">&gt;=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(current.year<span class="dv">-1</span>,<span class="st">"-01-01"</span>)))</a>
<a class="sourceLine" id="cb3-36" title="36"></a>
<a class="sourceLine" id="cb3-37" title="37">latest.years &lt;-<span class="st"> </span>dailyQ <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-38" title="38"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(Date <span class="op">&gt;=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(current.year<span class="dv">-1</span>,<span class="st">"-01-01"</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-39" title="39"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">day.of.year =</span> <span class="dv">1</span><span class="op">:</span><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(.))</a></code></pre></div>
</div>
<div id="plot-using-base-r" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-using-base-r" class="anchor"></a>Plot using base R</h2>
<p>Many of the graphical requirements defined by the USGS are difficult to achieve in <code>ggplot2</code>. Base R plotting can be used to obtain these types of graphs:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">title.text &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(stationInfo<span class="op">$</span>station_nm,<span class="st">"</span><span class="ch">\n</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb4-2" title="2">        <span class="st">"Provisional Data - Subject to change</span><span class="ch">\n</span><span class="st">"</span>,</a>
<a class="sourceLine" id="cb4-3" title="3">        <span class="st">"Record Start = "</span>, <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(dailyQ<span class="op">$</span>Date),</a>
<a class="sourceLine" id="cb4-4" title="4">        <span class="st">"  Number of years = "</span>,</a>
<a class="sourceLine" id="cb4-5" title="5">        <span class="kw"><a href="https://rdrr.io/r/base/integer.html">as.integer</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/difftime.html">difftime</a></span>(<span class="dt">time1 =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(dailyQ<span class="op">$</span>Date), </a>
<a class="sourceLine" id="cb4-6" title="6">        <span class="dt">time2 =</span> <span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(dailyQ<span class="op">$</span>Date),</a>
<a class="sourceLine" id="cb4-7" title="7">        <span class="dt">units =</span> <span class="st">"weeks"</span>))<span class="op">/</span><span class="fl">52.25</span>),</a>
<a class="sourceLine" id="cb4-8" title="8">        <span class="st">"</span><span class="ch">\n</span><span class="st">Date of plot = "</span>,<span class="kw"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date</a></span>(),</a>
<a class="sourceLine" id="cb4-9" title="9">        <span class="st">"  Drainage Area = "</span>,stationInfo<span class="op">$</span>drain_area_va, <span class="st">"mi^2"</span>)</a>
<a class="sourceLine" id="cb4-10" title="10"></a>
<a class="sourceLine" id="cb4-11" title="11">mid.month.days &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">15</span>, <span class="dv">45</span>, <span class="dv">74</span>, <span class="dv">105</span>, <span class="dv">135</span>, <span class="dv">166</span>, <span class="dv">196</span>, <span class="dv">227</span>, <span class="dv">258</span>, <span class="dv">288</span>, <span class="dv">319</span>, <span class="dv">349</span>)</a>
<a class="sourceLine" id="cb4-12" title="12">month.letters &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"J"</span>,<span class="st">"F"</span>,<span class="st">"M"</span>,<span class="st">"A"</span>,<span class="st">"M"</span>,<span class="st">"J"</span>,<span class="st">"J"</span>,<span class="st">"A"</span>,<span class="st">"S"</span>,<span class="st">"O"</span>,<span class="st">"N"</span>,<span class="st">"D"</span>)</a>
<a class="sourceLine" id="cb4-13" title="13">start.month.days &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">32</span>, <span class="dv">61</span>, <span class="dv">92</span>, <span class="dv">121</span>, <span class="dv">152</span>, <span class="dv">182</span>, <span class="dv">214</span>, <span class="dv">245</span>, <span class="dv">274</span>, <span class="dv">305</span>, <span class="dv">335</span>)</a>
<a class="sourceLine" id="cb4-14" title="14">label.text &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Normal"</span>,<span class="st">"Drought Watch"</span>,<span class="st">"Drought Warning"</span>,<span class="st">"Drought Emergency"</span>)</a>
<a class="sourceLine" id="cb4-15" title="15"></a>
<a class="sourceLine" id="cb4-16" title="16">summary.year1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(summaryQ[<span class="dv">2</span><span class="op">:</span><span class="dv">366</span>,])</a>
<a class="sourceLine" id="cb4-17" title="17">summary.year2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(summaryQ[<span class="dv">367</span><span class="op">:</span><span class="dv">733</span>,])</a>
<a class="sourceLine" id="cb4-18" title="18"></a>
<a class="sourceLine" id="cb4-19" title="19"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(latest.years<span class="op">$</span>day.of.year, latest.years<span class="op">$</span>rollMean, </a>
<a class="sourceLine" id="cb4-20" title="20">     <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">1000</span>), <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">733</span>),</a>
<a class="sourceLine" id="cb4-21" title="21">     <span class="dt">log=</span><span class="st">"y"</span>, <span class="dt">axes=</span><span class="ot">FALSE</span>, <span class="dt">type=</span><span class="st">"n"</span>, <span class="dt">xaxs=</span><span class="st">"i"</span>,<span class="dt">yaxs=</span><span class="st">"i"</span>,</a>
<a class="sourceLine" id="cb4-22" title="22">     <span class="dt">ylab =</span> <span class="st">"30-day moving ave"</span>,</a>
<a class="sourceLine" id="cb4-23" title="23">     <span class="dt">xlab =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb4-24" title="24"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(title.text, <span class="dt">cex.main =</span> <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb4-25" title="25"><span class="kw"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year1<span class="op">$</span>day.of.year,<span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year1<span class="op">$</span>day.of.year)),</a>
<a class="sourceLine" id="cb4-26" title="26">        <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year1<span class="op">$</span>sm<span class="fl">.75</span>, <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year1<span class="op">$</span>sm<span class="fl">.25</span>)), </a>
<a class="sourceLine" id="cb4-27" title="27">        <span class="dt">col =</span> <span class="st">"darkgreen"</span>, <span class="dt">border =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-28" title="28"><span class="kw"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year2<span class="op">$</span>day.of.year,<span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year2<span class="op">$</span>day.of.year)),</a>
<a class="sourceLine" id="cb4-29" title="29">        <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year2<span class="op">$</span>sm<span class="fl">.75</span>, <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year2<span class="op">$</span>sm<span class="fl">.25</span>)), </a>
<a class="sourceLine" id="cb4-30" title="30">        <span class="dt">col =</span> <span class="st">"darkgreen"</span>, <span class="dt">border =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-31" title="31"><span class="kw"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year1<span class="op">$</span>day.of.year,<span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year1<span class="op">$</span>day.of.year)),</a>
<a class="sourceLine" id="cb4-32" title="32">        <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year1<span class="op">$</span>sm<span class="fl">.25</span>, <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year1<span class="op">$</span>sm<span class="fl">.10</span>)), </a>
<a class="sourceLine" id="cb4-33" title="33">        <span class="dt">col =</span> <span class="st">"yellow"</span>, <span class="dt">border =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-34" title="34"><span class="kw"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year2<span class="op">$</span>day.of.year,<span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year2<span class="op">$</span>day.of.year)),</a>
<a class="sourceLine" id="cb4-35" title="35">        <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year2<span class="op">$</span>sm<span class="fl">.25</span>, <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year2<span class="op">$</span>sm<span class="fl">.10</span>)), </a>
<a class="sourceLine" id="cb4-36" title="36">        <span class="dt">col =</span> <span class="st">"yellow"</span>, <span class="dt">border =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-37" title="37"><span class="kw"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year1<span class="op">$</span>day.of.year,<span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year1<span class="op">$</span>day.of.year)),</a>
<a class="sourceLine" id="cb4-38" title="38">        <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year1<span class="op">$</span>sm<span class="fl">.10</span>, <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year1<span class="op">$</span>sm<span class="fl">.05</span>)), </a>
<a class="sourceLine" id="cb4-39" title="39">        <span class="dt">col =</span> <span class="st">"orange"</span>, <span class="dt">border =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-40" title="40"><span class="kw"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year2<span class="op">$</span>day.of.year,<span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year2<span class="op">$</span>day.of.year)),</a>
<a class="sourceLine" id="cb4-41" title="41">        <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year2<span class="op">$</span>sm<span class="fl">.10</span>, <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year2<span class="op">$</span>sm<span class="fl">.05</span>)), </a>
<a class="sourceLine" id="cb4-42" title="42">        <span class="dt">col =</span> <span class="st">"orange"</span>, <span class="dt">border =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-43" title="43"><span class="kw"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year1<span class="op">$</span>day.of.year,<span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year1<span class="op">$</span>day.of.year)),</a>
<a class="sourceLine" id="cb4-44" title="44">        <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year1<span class="op">$</span>sm<span class="fl">.05</span>, <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year1<span class="op">$</span>sm<span class="fl">.00</span>)), </a>
<a class="sourceLine" id="cb4-45" title="45">        <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">border =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-46" title="46"><span class="kw"><a href="https://rdrr.io/r/graphics/polygon.html">polygon</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year2<span class="op">$</span>day.of.year,<span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year2<span class="op">$</span>day.of.year)),</a>
<a class="sourceLine" id="cb4-47" title="47">        <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(summary.year2<span class="op">$</span>sm<span class="fl">.05</span>, <span class="kw"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(summary.year2<span class="op">$</span>sm<span class="fl">.00</span>)), </a>
<a class="sourceLine" id="cb4-48" title="48">        <span class="dt">col =</span> <span class="st">"red"</span>, <span class="dt">border =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-49" title="49"><span class="kw"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(latest.years<span class="op">$</span>day.of.year, latest.years<span class="op">$</span>rollMean, </a>
<a class="sourceLine" id="cb4-50" title="50">      <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col =</span> <span class="st">"black"</span>)</a>
<a class="sourceLine" id="cb4-51" title="51"><span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">v =</span> <span class="dv">366</span>)</a>
<a class="sourceLine" id="cb4-52" title="52"><span class="kw"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="dv">2</span>, <span class="dt">las=</span><span class="dv">1</span>, <span class="dt">at=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">100</span>, <span class="dv">1000</span>), <span class="dt">tck =</span> <span class="fl">-0.02</span>)</a>
<a class="sourceLine" id="cb4-53" title="53"><span class="kw"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="dv">2</span>, <span class="dt">at =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">1</span>,<span class="dv">90</span>, <span class="dt">by =</span> <span class="dv">10</span>)), <span class="dt">labels =</span> <span class="ot">NA</span>, <span class="dt">tck =</span> <span class="fl">-0.01</span>)</a>
<a class="sourceLine" id="cb4-54" title="54"><span class="kw"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="dv">2</span>, <span class="dt">at =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">100</span>,<span class="dv">1000</span>, <span class="dt">by =</span> <span class="dv">100</span>)), <span class="dt">labels =</span> <span class="ot">NA</span>, <span class="dt">tck =</span> <span class="fl">-0.01</span>)</a>
<a class="sourceLine" id="cb4-55" title="55"><span class="kw"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="dv">1</span>, <span class="dt">at =</span>  <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(mid.month.days,<span class="dv">365</span><span class="op">+</span>mid.month.days), </a>
<a class="sourceLine" id="cb4-56" title="56">     <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(month.letters,<span class="dv">2</span>), </a>
<a class="sourceLine" id="cb4-57" title="57">     <span class="dt">tick =</span> <span class="ot">FALSE</span>, <span class="dt">line =</span> <span class="fl">-0.5</span>, <span class="dt">cex.axis =</span> <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb4-58" title="58"><span class="kw"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="dv">1</span>, <span class="dt">at =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(start.month.days, <span class="dv">365</span><span class="op">+</span>start.month.days),</a>
<a class="sourceLine" id="cb4-59" title="59">     <span class="dt">labels =</span> <span class="ot">NA</span>, <span class="dt">tck =</span> <span class="fl">-0.02</span>)</a>
<a class="sourceLine" id="cb4-60" title="60"><span class="kw"><a href="https://rdrr.io/r/graphics/axis.html">axis</a></span>(<span class="dv">1</span>, <span class="dt">at =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">182</span>,<span class="dv">547</span>), <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(current.year<span class="dv">-1</span>,current.year), </a>
<a class="sourceLine" id="cb4-61" title="61">     <span class="dt">line =</span> <span class="fl">.5</span>, <span class="dt">tick =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-62" title="62"><span class="kw"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="st">"bottom"</span>, label.text, <span class="dt">horiz =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb4-63" title="63">       <span class="dt">fill =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"darkgreen"</span>,<span class="st">"yellow"</span>,<span class="st">"orange"</span>,<span class="st">"red"</span>),</a>
<a class="sourceLine" id="cb4-64" title="64">       <span class="dt">inset =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="dt">xpd =</span> <span class="ot">TRUE</span>, <span class="dt">bty =</span> <span class="st">"n"</span>, <span class="dt">cex =</span> <span class="fl">0.75</span>)</a>
<a class="sourceLine" id="cb4-65" title="65"><span class="kw"><a href="https://rdrr.io/r/graphics/box.html">box</a></span>()</a></code></pre></div>
<div class="figure">
<img src="movingAverages_files/figure-html/unnamed-chunk-4-1.png" alt="Simple 30-day moving average daily flow plot using base R" width="700"><p class="caption">
Simple 30-day moving average daily flow plot using base R
</p>
</div>
</div>
<div id="plot-using-ggplot2" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-using-ggplot2" class="anchor"></a>Plot using ggplot2</h2>
<p>Finally, we can also try to create the graph using the <code>ggplot2</code> package. The following script shows a simple way to re-create the graph in <code>ggplot2</code> with no effort on imitating desired style:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3">simple.plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> summaryQ, <span class="kw">aes</span>(<span class="dt">x =</span> day.of.year)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> sm<span class="fl">.25</span>, <span class="dt">ymax =</span> sm<span class="fl">.75</span>, <span class="dt">fill =</span> <span class="st">"Normal"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-5" title="5"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> sm<span class="fl">.10</span>, <span class="dt">ymax =</span> sm<span class="fl">.25</span>, <span class="dt">fill =</span> <span class="st">"Drought Watch"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> sm<span class="fl">.05</span>, <span class="dt">ymax =</span> sm<span class="fl">.10</span>, <span class="dt">fill =</span> <span class="st">"Drought Warning"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">ymin =</span> sm<span class="fl">.00</span>, <span class="dt">ymax =</span> sm<span class="fl">.05</span>, <span class="dt">fill =</span> <span class="st">"Drought Emergency"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="st">  </span><span class="kw">scale_y_log10</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1000</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">data =</span> latest.years, <span class="kw">aes</span>(<span class="dt">x=</span>day.of.year, <span class="dt">y=</span>rollMean, <span class="dt">color =</span> <span class="st">"30-Day Mean"</span>),<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="dv">365</span>) </a>
<a class="sourceLine" id="cb5-11" title="11"></a>
<a class="sourceLine" id="cb5-12" title="12">simple.plot</a></code></pre></div>
<div class="figure">
<img src="movingAverages_files/figure-html/unnamed-chunk-5-1.png" alt="Simple 30-day moving average daily flow plot using ggplot2" width="700"><p class="caption">
Simple 30-day moving average daily flow plot using ggplot2
</p>
</div>
<p>Next, we can play with various options to do a better job to imitate the style:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">styled.plot &lt;-<span class="st"> </span>simple.plot<span class="op">+</span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(mid.month.days,<span class="dv">365</span><span class="op">+</span>mid.month.days),</a>
<a class="sourceLine" id="cb6-3" title="3">                   <span class="dt">labels =</span> <span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(month.letters,<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb6-4" title="4">                   <span class="dt">expand =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb6-5" title="5">                   <span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">730</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="st">  </span><span class="kw">annotation_logticks</span>(<span class="dt">sides=</span><span class="st">"l"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="st">  </span><span class="kw">expand_limits</span>(<span class="dt">x=</span><span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="st">  </span><span class="kw">annotate</span>(<span class="dt">geom =</span> <span class="st">"text"</span>, </a>
<a class="sourceLine" id="cb6-9" title="9">           <span class="dt">x =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">182</span>,<span class="dv">547</span>), </a>
<a class="sourceLine" id="cb6-10" title="10">           <span class="dt">y =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb6-11" title="11">           <span class="dt">label =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(current.year<span class="dv">-1</span>,current.year), <span class="dt">size =</span> <span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.ticks.x=</span><span class="kw">element_blank</span>(),</a>
<a class="sourceLine" id="cb6-14" title="14">        <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(), </a>
<a class="sourceLine" id="cb6-15" title="15">        <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>()) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="st">  </span><span class="kw">labs</span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">title=</span>title.text,</a>
<a class="sourceLine" id="cb6-17" title="17">            <span class="dt">y =</span> <span class="st">"30-day moving ave"</span>, <span class="dt">x=</span><span class="st">""</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">name=</span><span class="st">""</span>,<span class="dt">breaks =</span> label.text,</a>
<a class="sourceLine" id="cb6-19" title="19">                    <span class="dt">values =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"red"</span>,<span class="st">"orange"</span>,<span class="st">"yellow"</span>,<span class="st">"darkgreen"</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-20" title="20"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">name =</span> <span class="st">""</span>, <span class="dt">values =</span> <span class="st">"black"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-21" title="21"><span class="st">   </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">"bottom"</span>)</a>
<a class="sourceLine" id="cb6-22" title="22"></a>
<a class="sourceLine" id="cb6-23" title="23">styled.plot</a></code></pre></div>
<div class="figure">
<img src="movingAverages_files/figure-html/unnamed-chunk-6-1.png" alt="Detailed 30-day moving average daily flow plot" width="700"><p class="caption">
Detailed 30-day moving average daily flow plot
</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#get-data-using-dataretrieval">Get data using dataRetrieval</a></li>
      <li><a href="#calculate-moving-average">Calculate moving average</a></li>
      <li><a href="#calculate-historical-percentiles">Calculate historical percentiles</a></li>
      <li><a href="#plot-using-base-r">Plot using base R</a></li>
      <li><a href="#plot-using-ggplot2">Plot using ggplot2</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Laura DeCicco, Robert Hirsch, David Lorenz, David Watkins.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9000.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
